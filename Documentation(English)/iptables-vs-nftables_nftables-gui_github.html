<html class="translated-ltr" lang="en">
<head>
<style type="text/css">.tsv-src-text {display: none !important} .tsv-src-active-text {display: block!important;color:black!important; font-size:14px!important;font-family:arial,sans-serif!important}.tsv-src-active-text a {font-size:14px!important}.tsv-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.tsv-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.tsv-src-active-text a:active {color:red!important;text-decoration:underline!important}</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Author" content="José María Caballero Alba">
<meta name="Title" content="Iptables vs Nftables - nftables-gui - github">
<meta name="Creator" content="LaTeX with hyperref package">
<meta name="Producer" content="pdfTeX-1.40.13">
<meta name="CreationDate" content="D:20150411100544+02'00'">
<meta name="ModDate" content="D:20150411100544+02'00'">
<meta name="Fullbanner" content="This is pdfTeX, Version 3.1415926-2.4-1.40.13 (TeX Live 2012/Debian) kpathsea version 6.1.0">
<title>Iptables vs Nftables - nftables-gui - github</title>
</head>
<body vlink="blue" link="blue" bgcolor="#ffffff">
<style>
.spinner-container {width:25%;top:20px;left:50%;margin-left:-12.5%;border-radius:8px;position:fixed;
text-align:center;box-shadow:0 0 10px rgba(0,0,0,0.24);background:#fff;overflow:hidden;}
.spinner-container p{font-family:'Roboto', Arial, sans-serif;color:rgba(0,0,0,0.87);margin:12px 0 16px 0;padding:0;font-size:12px;}
.spinner-container img{width:22px;height:22px;margin:16px 0 0;padding:0;}
</style>
<table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 1</font></font></b></a></font></td></tr></tbody></table>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:437;left:350"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iptables vs Nftables.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:16px;font-family:Times">
<div style="position:absolute;top:502;left:356"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">José María Caballero Alba</font></font></nobr></div>
<div style="position:absolute;top:547;left:404"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">April 11, 2015</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1214;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:1363;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 2</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:1542;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contents</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:1593;left:201"><nobr><a href="#5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 Foreword</font></font></a></nobr></div>
<div style="position:absolute;top:1593;left:708"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></nobr></div>
<div style="position:absolute;top:1638;left:201"><nobr><a href="#6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Main differences</font></font></a></nobr></div>
<div style="position:absolute;top:1638;left:708"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
<div style="position:absolute;top:1683;left:201"><nobr><a href="#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 Setting tables</font></font></a></nobr></div>
<div style="position:absolute;top:1683;left:708"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1714;left:223"><nobr><a href="#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Creating Iptables tables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">8</font></font></nobr></div>
<div style="position:absolute;top:1744;left:223"><nobr><a href="#8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Creating Nftables tables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">8</font></font></nobr></div>
<div style="position:absolute;top:1774;left:223"><nobr><a href="#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3 Listing tables in Iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">9</font></font></nobr></div>
<div style="position:absolute;top:1804;left:223"><nobr><a href="#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4 Listing tables in Nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">9</font></font></nobr></div>
<div style="position:absolute;top:1834;left:223"><nobr><a href="#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5 Deleting tables in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">10</font></font></nobr></div>
<div style="position:absolute;top:1864;left:223"><nobr><a href="#10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6 Deleting nftables tables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">10</font></font></nobr></div>
<div style="position:absolute;top:1894;left:223"><nobr><a href="#11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.7 Emptying tables in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">eleven</font></font></nobr></div>
<div style="position:absolute;top:1923;left:223"><nobr><a href="#11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.8 Emptying tables in nftables. </font><font style="vertical-align: inherit;">. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">eleven</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:1967;left:201"><nobr><a href="#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Configuring strings</font></font></a></nobr></div>
<div style="position:absolute;top:1967;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1998;left:223"><nobr><a href="#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1 Adding strings in Iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">12</font></font></nobr></div>
<div style="position:absolute;top:2028;left:223"><nobr><a href="#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2 Adding tables in nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">12</font></font></nobr></div>
<div style="position:absolute;top:2058;left:223"><nobr><a href="#13"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3 Deleting strings in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">13</font></font></nobr></div>
<div style="position:absolute;top:2088;left:223"><nobr><a href="#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 Deleting strings in nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">14</font></font></nobr></div>
<div style="position:absolute;top:2118;left:223"><nobr><a href="#14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 Flushing strings in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">14</font></font></nobr></div>
<div style="position:absolute;top:2148;left:223"><nobr><a href="#15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6 Emptying strings into nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">fifteen</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2191;left:201"><nobr><a href="#16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 Setting rules</font></font></a></nobr></div>
<div style="position:absolute;top:2191;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2222;left:223"><nobr><a href="#16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Adding rules in iptables </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">16</font></font></nobr></div>
<div style="position:absolute;top:2252;left:223"><nobr><a href="#16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Adding rules in nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">16</font></font></nobr></div>
<div style="position:absolute;top:2282;left:223"><nobr><a href="#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Removing rules in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:2312;left:223"><nobr><a href="#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4 Removing rules in nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:2402;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2551;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 3</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2736;left:201"><nobr><a href="#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 Atomic Rule Replacement</font></font></a></nobr></div>
<div style="position:absolute;top:2736;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2768;left:223"><nobr><a href="#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1 Atomic replacement of rules in iptables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">19</font></font></nobr></div>
<div style="position:absolute;top:2798;left:257"><nobr><a href="#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1 Atomic replacement of rules in nftables. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">19</font></font></nobr></div>
<div style="position:absolute;top:2827;left:257"><nobr><a href="#20"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2 Use of scripts in the rule change</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">twenty</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2871;left:201"><nobr><a href="#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 Error reporting from the command line</font></font></a></nobr></div>
<div style="position:absolute;top:2871;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twenty-one</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2902;left:223"><nobr><a href="#21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1 Reporting errors from the command line in iptables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">twenty-one</font></font></nobr></div>
<div style="position:absolute;top:2932;left:223"><nobr><a href="#22"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2 Reporting errors from the command line in nftables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">22</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2975;left:201"><nobr><a href="#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 Possible actions on packages</font></font></a></nobr></div>
<div style="position:absolute;top:2975;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3007;left:223"><nobr><a href="#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1 Possible actions on packets in iptables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">2. 3</font></font></nobr></div>
<div style="position:absolute;top:3037;left:257"><nobr><a href="#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.1 Accepting and rejecting packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">2. 3</font></font></nobr></div>
<div style="position:absolute;top:3067;left:257"><nobr><a href="#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.2 Jumping to chains. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">2. 3</font></font></nobr></div>
<div style="position:absolute;top:3096;left:257"><nobr><a href="#24"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.3 Package log. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">24</font></font></nobr></div>
<div style="position:absolute;top:3126;left:257"><nobr><a href="#25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.4 NAT. </font><font style="vertical-align: inherit;">. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">25</font></font></nobr></div>
<div style="position:absolute;top:3156;left:257"><nobr><a href="#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.5 Marks on packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">27</font></font></nobr></div>
<div style="position:absolute;top:3186;left:257"><nobr><a href="#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.6 Queueing of packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">27</font></font></nobr></div>
<div style="position:absolute;top:3216;left:223"><nobr><a href="#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2 Possible actions on packages in nftables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">29</font></font></nobr></div>
<div style="position:absolute;top:3246;left:257"><nobr><a href="#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1 Accepting and rejecting packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">29</font></font></nobr></div>
<div style="position:absolute;top:3276;left:257"><nobr><a href="#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2 Jumping to chains. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">29</font></font></nobr></div>
<div style="position:absolute;top:3306;left:257"><nobr><a href="#30"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3 Package log. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">30</font></font></nobr></div>
<div style="position:absolute;top:3336;left:257"><nobr><a href="#31"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4 NAT. </font><font style="vertical-align: inherit;">. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">31</font></font></nobr></div>
<div style="position:absolute;top:3366;left:223"><nobr><a href="#33"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3 Marks on packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">33</font></font></nobr></div>
<div style="position:absolute;top:3395;left:223"><nobr><a href="#34"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4 Queueing of packages. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">3. 4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:3439;left:201"><nobr><a href="#35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 Use of matchs</font></font></a></nobr></div>
<div style="position:absolute;top:3439;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3470;left:223"><nobr><a href="#35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1 Meta-information of packages. </font><font style="vertical-align: inherit;">. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">35</font></font></nobr></div>
<div style="position:absolute;top:3500;left:223"><nobr><a href="#36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2 Traffic limit. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">36</font></font></nobr></div>
<div style="position:absolute;top:3590;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:3739;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 4</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:3924;left:201"><nobr><a href="#37"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 advanced data structures in nftables</font></font></a></nobr></div>
<div style="position:absolute;top:3924;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3956;left:223"><nobr><a href="#37"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1 Sets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">37</font></font></nobr></div>
<div style="position:absolute;top:3986;left:257"><nobr><a href="#37"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1 Anonymous sets. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">37</font></font></nobr></div>
<div style="position:absolute;top:4015;left:257"><nobr><a href="#38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2 Named sets. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">38</font></font></nobr></div>
<div style="position:absolute;top:4045;left:257"><nobr><a href="#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.3 Listing sets. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">40</font></font></nobr></div>
<div style="position:absolute;top:4075;left:223"><nobr><a href="#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2 Dictionaries. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">40</font></font></nobr></div>
<div style="position:absolute;top:4105;left:257"><nobr><a href="#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.1 Anonymous dictionaries. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">40</font></font></nobr></div>
<div style="position:absolute;top:4135;left:257"><nobr><a href="#40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.2 Named dictionaries. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">40</font></font></nobr></div>
<div style="position:absolute;top:4165;left:257"><nobr><a href="#41"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.3 Intervals. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">41</font></font></nobr></div>
<div style="position:absolute;top:4195;left:257"><nobr><a href="#42"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.4 Maps. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">42</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:4238;left:201"><nobr><a href="#43"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11 Expressions in nftables</font></font></a></nobr></div>
<div style="position:absolute;top:4238;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43</font></font></nobr></div>
<div style="position:absolute;top:4283;left:201"><nobr><a href="#44"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 Example of practical use with nftables</font></font></a></nobr></div>
<div style="position:absolute;top:4283;left:699"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4778;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:4927;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 5</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:5106;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 Foreword</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5158;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is interesting to compare the use of iptables in a practical way and compare it with</font></font></nobr></div>
<div style="position:absolute;top:5188;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">what would be the translation to nftables, we have to take into account that some</font></font></nobr></div>
<div style="position:absolute;top:5218;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables options are not available in nftables as they are still under development</font></font></nobr></div>
<div style="position:absolute;top:5248;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and vice versa.</font></font></nobr></div>
<div style="position:absolute;top:5966;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:6115;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 6</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:6294;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Main differences</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6351;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first and most distinguishable is the syntax, in iptables, the flags go</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6376;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preceded by two hyphens or one (-p tcp) in nftables use one more syntax</font></font></nobr></div>
<div style="position:absolute;top:6406;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clean, inspired by tcpdump.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6452;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables and strings are fully configurable in nftables, with</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6478;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">misleadingly to iptables, which only offers a defined set of tables and strings,</font></font></nobr></div>
<div style="position:absolute;top:6508;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nftables allows you to create your own strings and tables with their corresponding</font></font></nobr></div>
<div style="position:absolute;top:6538;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurations depending on what you need.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6584;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no distinction between objectives and targets, in nftables we have express-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6609;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessions that are instructions for building our rules. </font><font style="vertical-align: inherit;">This is very</font></font></nobr></div>
<div style="position:absolute;top:6639;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different in iptables that requires syntax of targets and targets to use</font></font></nobr></div>
<div style="position:absolute;top:6669;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocols.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6715;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiple actions can be specified on a single line in nftables, with</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6741;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables we can only specify one.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6787;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The counters in iptables are set in a fixed way for each table</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6813;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and rules, in nftables you can optionally set these contacts</font></font></nobr></div>
<div style="position:absolute;top:6843;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dores.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6889;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generic infrastructure in sets in nftables, this allows</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6914;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">advanced settings like dictionaries, maps.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6960;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updating the kernel is a time consuming task, especially-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6986;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mind if you want to keep more than one firewall on your network. </font><font style="vertical-align: inherit;">The distributors</font></font></nobr></div>
<div style="position:absolute;top:7016;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they usually use older versions of the linux kernel for reasons of</font></font></nobr></div>
<div style="position:absolute;top:7046;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stability. </font><font style="vertical-align: inherit;">With the new nftables state machine there is no need</font></font></nobr></div>
<div style="position:absolute;top:7076;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update the kernel for a new protocol, it is simply necessary</font></font></nobr></div>
<div style="position:absolute;top:7106;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update the nft utility.</font></font></nobr></div>
<div style="position:absolute;top:7154;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7303;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 7</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:7494;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not necessary to use hyphens (-) or double hyphens () to use</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7520;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the flags.</font></font><a href="#7"></a><font style="font-size:10px"><a href="#7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></a></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:10px;font-family:Times">
<div style="position:absolute;top:8282;left:217"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font><font style="font-size:11px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This information is taken from the nftables wiki </font></font></font><font style="font-size:13px"><a href="http://wiki.nftables.org/wiki-nftables/index.php/Main_differences_with_iptables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://wiki.nftables.org/</font></font></a></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:8297;left:201"><nobr><a href="http://wiki.nftables.org/wiki-nftables/index.php/Main_differences_with_iptables"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki- nftables / index.php / Main_differences_with_iptables</font></font></a></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8342;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:8491;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 8</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:8670;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 Setting tables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:8723;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Creating Iptables tables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8767;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iptables has 5 tables (raw, filter, nat, mangle, security) that are zones</font></font></nobr></div>
<div style="position:absolute;top:8797;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where a chain of can apply.</font></font></nobr></div>
<div style="position:absolute;top:8827;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These tables are by default, they already come with a series of strings per</font></font></nobr></div>
<div style="position:absolute;top:8857;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default (input, output, postrouting, prerouting etc). </font><font style="vertical-align: inherit;">These come without rules.</font></font></nobr></div>
<div style="position:absolute;top:8887;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To configure the tables we have the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:8932;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t [table] [-AIRELNPDZ] [STRING] [PARAMETERS] [-j AC-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8957;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CION]</font></font></nobr></div>
<div style="position:absolute;top:8998;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables to be able to configure a table, we have to use by obligation</font></font></nobr></div>
<div style="position:absolute;top:9028;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of the chains, since it does not allow us to attack only one table.</font></font></nobr></div>
<div style="position:absolute;top:9058;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To make a simple example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9103;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter -P INPUT -j drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9140;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will be applying the default policy of rejecting packages from the</font></font></nobr></div>
<div style="position:absolute;top:9169;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input string.</font></font></nobr></div>
<div style="position:absolute;top:9199;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We must take into account that to configure a table in iptables,</font></font></nobr></div>
<div style="position:absolute;top:9229;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">also requires configuring at least one of the strings in that table.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:9280;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Creating Nftables tables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9324;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables we still have the same tables as in iptables, which follow</font></font></nobr></div>
<div style="position:absolute;top:9354;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">being the areas where we can create chains and then create rules in</font></font></nobr></div>
<div style="position:absolute;top:9384;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they. </font><font style="vertical-align: inherit;">The main and most notable difference from iptables that we can</font></font></nobr></div>
<div style="position:absolute;top:9414;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create our tables and also does not force us to configure a string at the time</font></font></nobr></div>
<div style="position:absolute;top:9444;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to create it. </font><font style="vertical-align: inherit;">To configure a table in nftables we have the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9489;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft create table [ip] table_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9530;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9679;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 9</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9866;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we see we have a simpler format that we can also create the</font></font></nobr></div>
<div style="position:absolute;top:9896;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table only without setting anything and deciding if it belongs (or not) to the family</font></font></nobr></div>
<div style="position:absolute;top:9926;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip.</font></font></nobr></div>
<div style="position:absolute;top:9955;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A very simple example of creating a table:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10001;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft create table filter</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10039;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will create the ip type table (by default, if we have not specified it) filter,</font></font></nobr></div>
<div style="position:absolute;top:10069;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which does not contain chains or rules. </font><font style="vertical-align: inherit;">It only contains the definition of the table in</font></font></nobr></div>
<div style="position:absolute;top:10099;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herself.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:10150;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3 Listing tables in Iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10194;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can show list the tables, to specify a specific one</font></font></nobr></div>
<div style="position:absolute;top:10224;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can use the -t table parameter. </font><font style="vertical-align: inherit;">To display the table (along with its</font></font></nobr></div>
<div style="position:absolute;top:10254;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strings and their rules, not just the names of the tables) just:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10300;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -L</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10338;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will not show the content of the table, with its strings and its rules, we will not</font></font></nobr></div>
<div style="position:absolute;top:10368;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is listing the tables. </font><font style="vertical-align: inherit;">By not using the -t parameter, the default is</font></font></nobr></div>
<div style="position:absolute;top:10398;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filter table.</font></font></nobr></div>
<div style="position:absolute;top:10427;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To list a specific table, we will use:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10473;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t table_name -L</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:10521;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4 Listing tables in Nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10565;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unlike iptables, nftables does allow us to list the tables and not</font></font></nobr></div>
<div style="position:absolute;top:10594;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forces you to view its content. </font><font style="vertical-align: inherit;">To list the tables we can simply do</font></font></nobr></div>
<div style="position:absolute;top:10624;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10670;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list tables</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10718;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:10867;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 10</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11054;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We must notice that tables, ends in s, that is to say plural, therefore this</font></font></nobr></div>
<div style="position:absolute;top:11084;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listing the names of the tables.</font></font></nobr></div>
<div style="position:absolute;top:11114;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the contrary, if we want to list only one table and now what does the</font></font></nobr></div>
<div style="position:absolute;top:11143;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content of this table with its chains and rules, it would be enough with:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:11186;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list table table_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11220;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This would not show exactly the same content as in iptables.</font></font></nobr></div>
<div style="position:absolute;top:11250;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eg of screenshots:</font></font></nobr></div>
<div style="position:absolute;top:11275;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter -L:</font></font></nobr></div>
<div style="position:absolute;top:11290;left:223"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch3.4_Pg10_iptables-t-filter-l.png" /></nobr></div>
<div style="position:absolute;top:11493;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list tables:</font></font></nobr></div>
<div style="position:absolute;top:11510;left:223"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch3.4_Pg10_nft-list-tables.png" /></nobr></div>
<div style="position:absolute;top:11582;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we see, in nftables we have the option of listing only the tables and</font></font></nobr></div>
<div style="position:absolute;top:11612;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listing in iptables mode for a specific table.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:11662;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5 Deleting tables in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11706;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we cannot delete a table, we can empty its chains, or delete</font></font></nobr></div>
<div style="position:absolute;top:11736;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the rules, but the tables still exist.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:11787;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6 Deleting nftables tables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11831;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables if we are allowed to delete a table, with this we would delete the</font></font></nobr></div>
<div style="position:absolute;top:11861;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table, its chains and its rules. </font><font style="vertical-align: inherit;">The format to use would be the following:</font></font></nobr></div>
<div style="position:absolute;top:11906;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:12055;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 11</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12246;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft delete table table_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12284;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And nothing else is necessary, with this we can delete a table in nftables,</font></font></nobr></div>
<div style="position:absolute;top:12313;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">something that with iptables we could not.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:12365;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.7 Emptying tables in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12409;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables to flush the tables (we can't delete the strings, just</font></font></nobr></div>
<div style="position:absolute;top:12439;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can empty them) in general we could do:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12485;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter flush</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12522;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This would empty all the all the strings in the filter table. </font><font style="vertical-align: inherit;">If we omit the</font></font></nobr></div>
<div style="position:absolute;top:12552;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t parameter, it would empty all the strings of the filter table.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:12604;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.8 Emptying tables in nftables.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12648;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables if we can empty tables in the same way, that is, we can</font></font></nobr></div>
<div style="position:absolute;top:12678;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remove all rules from strings containing table:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12724;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft flush table table_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12761;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would remove the rules from the specified table.</font></font></nobr></div>
<div style="position:absolute;top:13094;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eleven</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:13243;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 12</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:13422;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Configuring strings</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:13475;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1 Adding strings in Iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13519;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we already have by default strings associated with our tables, although</font></font></nobr></div>
<div style="position:absolute;top:13549;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom strings can be added, eg by default the filter table has</font></font></nobr></div>
<div style="position:absolute;top:13579;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the input output and forward strings, so if we want to add a</font></font></nobr></div>
<div style="position:absolute;top:13609;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new string to the filter table we can do it with the -N option like this:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13655;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables [-t table] -N string_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13692;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the filter table:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13738;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter -N new_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13776;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or also:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13822;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -N new_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13860;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remember that in iptables the default table is filter</font></font></nobr></div>
<div style="position:absolute;top:13872;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch4.1_Pg12_iptables-L.png" /></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:14157;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2 Adding tables in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14201;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables we don't have default strings inside our tables, but</font></font></nobr></div>
<div style="position:absolute;top:14231;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we have the possibility of adding the base type chains (input, output, forward,</font></font></nobr></div>
<div style="position:absolute;top:14282;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:14431;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 13</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14618;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postrouting, prerouting) or create custom chains, with the following format</font></font></nobr></div>
<div style="position:absolute;top:14648;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">would be for base types:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14694;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain ip table_name chain_name {type filter hook [ca-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14719;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dena_base] priority 0 \; </font><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:14761;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14807;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain ip filter postrouting {type filter hook postrouting priority</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14833;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 \; </font><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:14875;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This would not create the postrouting base type string inside the filter table, if</font></font></nobr></div>
<div style="position:absolute;top:14905;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we want to have custom strings, we simply do:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14951;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain table_name chain_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14988;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:15034;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain filter input</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15072;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This does not create a custom string inside the filter table. </font><font style="vertical-align: inherit;">We can</font></font></nobr></div>
<div style="position:absolute;top:15102;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appreciate in the following screenshot:</font></font></nobr></div>
<div style="position:absolute;top:15115;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch4.2_Pg13_nft-add-chain-filter-input.png" /></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:15306;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3 Deleting strings in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15350;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we cannot delete the default strings but we can delete the custom ones,</font></font></nobr></div>
<div style="position:absolute;top:15380;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we have the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:15426;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables [-t table] -X string_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15470;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15619;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 14</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15806;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we continue with the previous example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:15852;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -X new_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15889;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will remove the new_string string from the filter table (default) and the</font></font></nobr></div>
<div style="position:absolute;top:15919;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rules contained in it.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:15971;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 Deleting strings in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16015;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables on the contrary we can delete both base and non-base chains,</font></font></nobr></div>
<div style="position:absolute;top:16045;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we just need the name of the string, we don't care if it's of one type or another,</font></font></nobr></div>
<div style="position:absolute;top:16074;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we have the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16120;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft delete chain table_name chain_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16158;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16204;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft delete chain filter output</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16242;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only requirement that nftables imposes on us in order to delete a string is that</font></font></nobr></div>
<div style="position:absolute;top:16272;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not empty, if not, it will give us the following error:</font></font></nobr></div>
<div style="position:absolute;top:16287;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch4.4_Pg14_nft-delete-chain-filter-input.png" /></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:16387;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 Flushing strings in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16431;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can empty default or custom chains with the following</font></font></nobr></div>
<div style="position:absolute;top:16461;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16507;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables [-t table_name] flush [string_name]</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16544;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16591;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter flush INPUT</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16658;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:16807;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 15</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:16989;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6 Flushing strings in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17033;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To empty a base or custom string (we don't care) just:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:17079;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft flush chain table_name chain_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17117;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:17163;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft flush chain filter input</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17201;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will not empty the rules that are in the input string.</font></font></nobr></div>
<div style="position:absolute;top:17846;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fifteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17995;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 16</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:18174;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 Setting rules</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:18227;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Adding rules in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18271;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can add rules using the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18317;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables [-t table] -A string_name [-i -o sport dport -p -j] [drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18343;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reject accept masquerade dnat snat]</font></font></nobr></div>
<div style="position:absolute;top:18385;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The parameters are simplified only some of the most usual, can be</font></font></nobr></div>
<div style="position:absolute;top:18414;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">see everything using man iptables</font></font></nobr></div>
<div style="position:absolute;top:18444;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18490;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp dport 22 -j DROP</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18528;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are doing in this last rule, that in the filter table (by default) in the</font></font></nobr></div>
<div style="position:absolute;top:18558;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INPUT string, packets using tcp on port 22 (ssh) are rejected.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:18609;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Adding rules in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18653;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables we can see when adding rules that it is much more comprehensive.</font></font></nobr></div>
<div style="position:absolute;top:18683;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sible to the user. </font><font style="vertical-align: inherit;">The format to add a rule is:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18729;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name [tcp upd ip] [daddr saddr</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18755;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dport sport] [drop accept reject counter]</font></font></nobr></div>
<div style="position:absolute;top:18797;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The parameters are simplified, there are only some of the most common, they are</font></font></nobr></div>
<div style="position:absolute;top:18827;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">see all possible options in man nft</font></font></nobr></div>
<div style="position:absolute;top:18857;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we wanted to use the above iptables example, this would suffice:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18903;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input tcp dport 22 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18940;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can see that nftables offers a clearer interface in creating</font></font></nobr></div>
<div style="position:absolute;top:18970;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rules regarding iptables.</font></font></nobr></div>
<div style="position:absolute;top:19034;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:19183;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 17</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:19365;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Removing rules in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19409;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To eliminate rules in iptables we can do it by listing the rules and seeing their</font></font></nobr></div>
<div style="position:absolute;top:19439;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number, using the line-number parameter</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19485;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables [-t table_name] -L line-number</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19523;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resulting in this:</font></font></nobr></div>
<div style="position:absolute;top:19539;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch5.3_Pg17_iptables-t-table-name-L-line-number.png" /></nobr></div>
<div style="position:absolute;top:19618;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once the rule to eliminate is identified, we only need its number</font></font></nobr></div>
<div style="position:absolute;top:19648;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to remove it using the -D parameter and the string where the ruler is, in the</font></font></nobr></div>
<div style="position:absolute;top:19678;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">last case:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19724;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter -D INPUT 1</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19762;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To eliminate all the rules of a chain (flush) we can use the</font></font></nobr></div>
<div style="position:absolute;top:19792;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flush parameter indicating the string</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19838;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t filter flush INPUT</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:19885;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4 Removing rules in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19929;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To remove a rule in nftables we can do it in a similar way as</font></font></nobr></div>
<div style="position:absolute;top:19959;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we do it in iptables, listing the rules of a specific table (in our</font></font></nobr></div>
<div style="position:absolute;top:19989;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filter case) with the -a parameter to show us the number of the rules</font></font></nobr></div>
<div style="position:absolute;top:20019;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside the table.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20065;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list [table | </font><font style="vertical-align: inherit;">tables] [table_name -a]</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20102;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20148;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list table filter -a</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20222;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20371;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 18</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20558;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resulting in this:</font></font></nobr></div>
<div style="position:absolute;top:20572;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch5.4_Pg18_nft-list-table-filter-a.png" /></nobr></div>
<div style="position:absolute;top:20670;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way, we identify the rule that we want to eliminate by means of its</font></font></nobr></div>
<div style="position:absolute;top:20700;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle, to then execute the delete order with the following</font></font></nobr></div>
<div style="position:absolute;top:20730;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20776;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft delete rule table_name string_name handle rule_number</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20814;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For our case:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20860;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft delete rule filter input handle 2.</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20897;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To delete all the rules of a chain (flush)</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20943;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft flush chain filter input</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21410;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:21559;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 19</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:21738;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 Atomic Rule Replacement</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:21791;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1 Atomic rule replacement in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21835;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can make an atomic change of the rules using a</font></font></nobr></div>
<div style="position:absolute;top:21865;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text file where we have stored the rules and using the utilities</font></font></nobr></div>
<div style="position:absolute;top:21895;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables-save and iptables-restore.</font></font></nobr></div>
<div style="position:absolute;top:21925;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To save the current rules:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:21971;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables-save [-c] [-t table]&gt; file.txt</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22008;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option c allows us to also save the counters, and -t the table (for</font></font></nobr></div>
<div style="position:absolute;top:22038;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default filter)</font></font></nobr></div>
<div style="position:absolute;top:22068;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once we have our file file.txt we can restore it in a fu-</font></font></nobr></div>
<div style="position:absolute;top:22098;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I try using iptables-restore:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:22144;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables-restore [-c] [-n] &lt;file.txt</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22182;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The -c option allows us to reset the current byte counters to those of the</font></font></nobr></div>
<div style="position:absolute;top:22212;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file and the -n option allow us not to rewrite the existing rules in the tables.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:22261;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1 Atomic rule replacement in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22302;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables it is also possible to make an atomic rule replacement, for this</font></font></nobr></div>
<div style="position:absolute;top:22332;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can save the current rules in the style of iptables saving them in a</font></font></nobr></div>
<div style="position:absolute;top:22362;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text file:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:22408;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list table table_name&gt; rules.txt</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22445;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will save the rules present in the table indicating the file rules.txt.</font></font></nobr></div>
<div style="position:absolute;top:22475;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When we want to restore them we simply do:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:22521;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft -f rules.txt</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22598;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22747;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 20</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:22932;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2 Use of scripts in rule change</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22973;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since iptables and nftables use an atomic rule change, it is not recommended</font></font></nobr></div>
<div style="position:absolute;top:23003;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the use of scripts that have a series of commands to flush</font></font></nobr></div>
<div style="position:absolute;top:23033;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of current rules, and then enter the new rules into ipta-</font></font></nobr></div>
<div style="position:absolute;top:23063;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bles / nftables. </font><font style="vertical-align: inherit;">In this way, an atomic change is not being executed and therefore</font></font></nobr></div>
<div style="position:absolute;top:23093;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">therefore, it is possible that this non-atomic change could filter</font></font></nobr></div>
<div style="position:absolute;top:23123;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or filter packets that do not correspond to our rules within the firewall.</font></font></nobr></div>
<div style="position:absolute;top:23786;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twenty</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:23935;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 21</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:24114;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 Error reporting from the command line</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:24167;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1 Reporting errors from the command line in ipt-</font></font></nobr></div>
<div style="position:absolute;top:24202;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24246;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When we have some kind of error in iptables either a table / string there</font></font></nobr></div>
<div style="position:absolute;top:24276;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">found or an error in the argument entered, iptables reports the error</font></font></nobr></div>
<div style="position:absolute;top:24306;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corresponding, eg:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24352;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A CADENA_ERRONEA DROP</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24389;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will get the following answer:</font></font></nobr></div>
<div style="position:absolute;top:24407;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.1_Pg21_iptables-A-CADENA-ERRONEA-DROP.png" /></nobr></div>
<div style="position:absolute;top:24480;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we see, it reports the error to the DROP argument, not to the string, if</font></font></nobr></div>
<div style="position:absolute;top:24510;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We remove the drop from the order:</font></font></nobr></div>
<div style="position:absolute;top:24524;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.1_Pg21_drop-removed.png" /></nobr></div>
<div style="position:absolute;top:24590;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now if it recognizes the wrong string, therefore it can lead to errors</font></font></nobr></div>
<div style="position:absolute;top:24620;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compression by the user, if we also include several errors such as:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:24666;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t fake_table -A fake_string drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24704;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will obtain:</font></font></nobr></div>
<div style="position:absolute;top:24718;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.1_Pg21_bad-argument-drop.png" /></nobr></div>
<div style="position:absolute;top:24764;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we can see, 2 faults have been introduced but it shows the error in</font></font></nobr></div>
<div style="position:absolute;top:24793;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drop, when errors are found in table and string names.</font></font></nobr></div>
<div style="position:absolute;top:24823;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This can be confusing, we will see in the next section that with nftables</font></font></nobr></div>
<div style="position:absolute;top:24853;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This behavior is solved.</font></font></nobr></div>
<div style="position:absolute;top:24974;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twenty-one</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:25123;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 22</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:25305;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2 Reporting errors from the command line in nfta-</font></font></nobr></div>
<div style="position:absolute;top:25340;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bles</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:25384;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables we also have support for errors introduced from</font></font></nobr></div>
<div style="position:absolute;top:25414;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the command line, if we take the same examples from the previous section</font></font></nobr></div>
<div style="position:absolute;top:25444;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we would have:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:25490;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter false_chain drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:25528;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get the following:</font></font></nobr></div>
<div style="position:absolute;top:25544;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.2_Pg22_1.png" /></nobr></div>
<div style="position:absolute;top:25600;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we see, it gives us a general error, not an error in the drop as in iptables,</font></font></nobr></div>
<div style="position:absolute;top:25630;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if we continue with the previous example, if we remove the drop argument:</font></font></nobr></div>
<div style="position:absolute;top:25645;left:201"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.2_Pg22_2.png" /></nobr></div>
<div style="position:absolute;top:25712;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It indicates that we have an error in the syntax and it indicates where the</font></font></nobr></div>
<div style="position:absolute;top:25742;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error, this gives us a general idea of ​​the error better than in iptables.</font></font></nobr></div>
<div style="position:absolute;top:25771;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We continue with the previous examples, if we use a false table:</font></font></nobr></div>
<div style="position:absolute;top:25786;left:223"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch7.2_Pg22_3.png" /></nobr></div>
<div style="position:absolute;top:25835;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It gives us a general error. </font><font style="vertical-align: inherit;">COMPLETE WITH MORE INFORMATION PRE-</font></font></nobr></div>
<div style="position:absolute;top:25865;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GUNTAR</font></font></nobr></div>
<div style="position:absolute;top:26162;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:26311;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 23</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:26490;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 Possible actions on packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:26543;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1 Possible actions on packets in iptables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26585;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.1 Accepting and rejecting packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26627;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables, in order to accept packets, we must take into account the following</font></font></nobr></div>
<div style="position:absolute;top:26656;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26700;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A [string_name] [-t table] [-i interface] [-p] [tcp | udp] [dport</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26726;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sport] [-port] -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:26766;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example, that we want to accept packets from eg the ftp port:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26809;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -t filter -i wlan0 -p tcp dport 21 -j ACCEPT</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26845;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resulting:</font></font></nobr></div>
<div style="position:absolute;top:26860;left:210"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch8.1.1_Pg23_1.png" /></nobr></div>
<div style="position:absolute;top:26937;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To reject packages, we have the same format, only changing the last one</font></font></nobr></div>
<div style="position:absolute;top:26967;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parameter:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27010;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A [string_name] [-t table] [-i interface] [-p] [tcp | udp] [dport</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27036;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sport] [-port] -j DROP</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:27085;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.2 Jumping to chains</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27126;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can jump packets to our own chains, for example,</font></font></nobr></div>
<div style="position:absolute;top:27156;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can previously create the own chain:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27200;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -N own_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27235;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once created, we can add rules to this chain and then skip it</font></font></nobr></div>
<div style="position:absolute;top:27265;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the base strings as follows:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27309;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp -j own_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27350;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 3</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27499;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 24</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27686;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will cause the packages to come to our system (INPUT chain) by</font></font></nobr></div>
<div style="position:absolute;top:27716;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the tcp protocol will be directed to our own chain.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:27765;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.3 Package log</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27806;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables we can make a log of the packets that go through our firewall,</font></font></nobr></div>
<div style="position:absolute;top:27836;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">just use the LOG parameter, for example, if we want our system</font></font></nobr></div>
<div style="position:absolute;top:27866;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">record ssh connections to our system, we must use the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27911;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A [string] [filter parameters] -j LOG [log-prefix ''] [log-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27937;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">level NUM]</font></font></nobr></div>
<div style="position:absolute;top:27978;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28024;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp -m tcp dport 22 -j LOG log-prefix 'access to</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28049;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh from outside 'log-level 4</font></font></nobr></div>
<div style="position:absolute;top:28091;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28136;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p indicates the protocol</font></font></font></nobr></div>
<div style="position:absolute;top:28178;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m indicates that packages are marked with the tcp mark</font></font></font></nobr></div>
<div style="position:absolute;top:28219;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-dport is the destination port</font></font></font></nobr></div>
<div style="position:absolute;top:28261;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j the action to be performed, in this case the package log</font></font></font></nobr></div>
<div style="position:absolute;top:28302;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log-prefix indicates that the prefix will be used in quotation marks</font></font></font></nobr></div>
<div style="position:absolute;top:28344;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log-level 4 will activate syslog only when the message is of type waring (4)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28381;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way, if we make an attempt to connect to our host by ssh and</font></font></nobr></div>
<div style="position:absolute;top:28411;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we see the log file (/var/log/syslog) we will see the following:</font></font></nobr></div>
<div style="position:absolute;top:28426;left:210"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch8.1.3_Pg24_1.png" /></nobr></div>
<div style="position:absolute;top:28538;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:28687;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 25</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28874;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way we can make an accurate log and monitor access to</font></font></nobr></div>
<div style="position:absolute;top:28904;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a server for example, for critical services there would be in this one, such as ssh,</font></font></nobr></div>
<div style="position:absolute;top:28934;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql, rsync, ftp, etc.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28982;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.4 NAT</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29023;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To use nat in iptables, we need to use the nat table (by default we use</font></font></nobr></div>
<div style="position:absolute;top:29053;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filter) and first of all, since we are going to use nat and therefore a behavior</font></font></nobr></div>
<div style="position:absolute;top:29083;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">router, we must activate the bit of ip_forward:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:29126;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 1&gt; / proc / sys / net / ipv4 / ip_forward</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29163;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. SOURCE NAT</font></font></nobr></div>
<div style="position:absolute;top:29204;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By using nat in POSTROUTING we are changing the source addresses of</font></font></nobr></div>
<div style="position:absolute;top:29234;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the packages and these, in the event that there is a communication with a host</font></font></nobr></div>
<div style="position:absolute;top:29264;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">external to our network, the response packets must reach the</font></font></nobr></div>
<div style="position:absolute;top:29294;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">original host so we need to re-translate the destination address to</font></font></nobr></div>
<div style="position:absolute;top:29324;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that host, this is automatic in iptables.</font></font></nobr></div>
<div style="position:absolute;top:29353;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To make SOURCE NAT (dynamic) with the network that we normally use,</font></font></nobr></div>
<div style="position:absolute;top:29383;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for example 192.168.1.0/24</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:29426;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o wlan0 -j MORE-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29452;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QUERADE</font></font></nobr></div>
<div style="position:absolute;top:29491;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:29534;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-A POSTROUTING adds the rule to the POSTROUTING chain</font></font></font></nobr></div>
<div style="position:absolute;top:29574;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s indicates the network in network bar notation that we want to do nat</font></font></font></nobr></div>
<div style="position:absolute;top:29615;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o eth0 the output interface of packets</font></font></font></nobr></div>
<div style="position:absolute;top:29655;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j MASQUERADE the action in this case, indicates that the output packets,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29681;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They will have the IP of origin of our host (the one that does nat) if it has been</font></font></nobr></div>
<div style="position:absolute;top:29726;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29875;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 26</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30062;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamically assigned (DHCP) and saves us from having to put our</font></font></nobr></div>
<div style="position:absolute;top:30092;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamic ip, you can also do a static snat with the ip that</font></font></nobr></div>
<div style="position:absolute;top:30122;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we want (which should be ours) using -j SNAT to:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:30163;left:255"><nobr>  <font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o wlan0 -j</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30194;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SNAT to 8.8.8.8</font></font></nobr></div>
<div style="position:absolute;top:30237;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. DESTINATION NAT</font></font></nobr></div>
<div style="position:absolute;top:30279;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESTINATION NAT is used to modify the destination address of a</font></font></nobr></div>
<div style="position:absolute;top:30309;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make sure that it reaches our system, for example, if we are using nat, the dis-</font></font></nobr></div>
<div style="position:absolute;top:30339;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">positives of our network are not visible, only the host that uses nat, is the visible</font></font></nobr></div>
<div style="position:absolute;top:30369;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">therefore, if there is a web server in our internet, we must redirect</font></font></nobr></div>
<div style="position:absolute;top:30399;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">turn packets coming through port 80 to this host, this would be as follows</font></font></nobr></div>
<div style="position:absolute;top:30429;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">way:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:30472;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -t nat -A PREROUTING -p tcp dport 80 -i eth0 -j DNAT to</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30498;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.5</font></font></nobr></div>
<div style="position:absolute;top:30538;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:30581;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-A PREROUTING indicates that it will be added to the PREROUTING string</font></font></font></nobr></div>
<div style="position:absolute;top:30622;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p tcp the protocol used</font></font></font></nobr></div>
<div style="position:absolute;top:30662;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dport 80 the destination port</font></font></font></nobr></div>
<div style="position:absolute;top:30703;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i eth0 the input interface the package</font></font></font></nobr></div>
<div style="position:absolute;top:30744;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j DNAT to the action on the packet, in this case, change the destination</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30769;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at 192.168.1.5</font></font></nobr></div>
<div style="position:absolute;top:30809;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way we are altering the package by modifying its destination, for this-</font></font></nobr></div>
<div style="position:absolute;top:30839;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are implementing dnat over our firewall to packets that come through</font></font></nobr></div>
<div style="position:absolute;top:30869;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port 80 from outside our network.</font></font></nobr></div>
<div style="position:absolute;top:30914;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31063;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 27</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31248;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.5 Marks on packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31289;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One functionality of iptables is the ability to mark packets with a</font></font></nobr></div>
<div style="position:absolute;top:31319;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number, it is implemented using the set-mark parameter, for example we could dial</font></font></nobr></div>
<div style="position:absolute;top:31349;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packets leaving port 80 to see what pages users visit</font></font></nobr></div>
<div style="position:absolute;top:31379;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from our network:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31425;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A PREROUTING -i eth0 -t mangle -p tcp dport 80 -j MARK</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31451;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> set-mark 1</font></font></nobr></div>
<div style="position:absolute;top:31492;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31538;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t mangle refers to the mangle table</font></font></font></nobr></div>
<div style="position:absolute;top:31580;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j MARK ser-mark is the action in this case, mark the packet with a 1</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31620;left:260"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information obtained from http://tldp.org/HOWTO/Adv-Routing-</font></font></nobr></div>
<div style="position:absolute;top:31650;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HOWTO / lartc.netfilter.html</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31699;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1.6 Queueing of packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31740;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queue is a special iptables action that passes the packet into a destination queue.</font></font></nobr></div>
<div style="position:absolute;top:31770;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nothing to processing in user space. </font><font style="vertical-align: inherit;">For this to be useful, it is necessary</font></font></nobr></div>
<div style="position:absolute;top:31800;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 other additional components:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31846;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A queue controller, which carries the actual packet passing mechanics</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31872;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">between the kernel and the user space.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31918;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A process in user space that receives, possibly manipulates, and</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31943;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dictates verdict on packages.</font></font></nobr></div>
<div style="position:absolute;top:31985;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example of how to use iptables to queue packets for your</font></font></nobr></div>
<div style="position:absolute;top:32015;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process in user space:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32061;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modprobe iptable_filter</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32102;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32251;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 28</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32442;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modprobe ip_queue (outdated, nfnetlink_queue should now be used)</font></font></font></nobr></div>
<div style="position:absolute;top:32484;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A OUTPUT -p icmp -j QUEUE</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32521;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this rule, locally generated ICMP packets (like the ones you create,</font></font></nobr></div>
<div style="position:absolute;top:32551;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let's say, ping), they are passed to the ip_queue module, which then tries to pass them to</font></font></nobr></div>
<div style="position:absolute;top:32581;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an application in user space. </font><font style="vertical-align: inherit;">If there is no application waiting for</font></font></nobr></div>
<div style="position:absolute;top:32611;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they are then discarded.</font></font></nobr></div>
<div style="position:absolute;top:32641;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can check the status of ip_queue by:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32687;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ proc / net / ip_queue (outdated, replace ip_queue with nfnetlink_queue)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32728;left:260"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: the information about the queue in iptables, has been removed in</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:32757;left:238"><nobr><a href="http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html</font></font></a></nobr></div>
<div style="position:absolute;top:32787;left:238"><nobr><a href="http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></a></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33290;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:33439;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 29</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:33621;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2 Possible actions on packages in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:33664;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.1 Accepting and rejecting packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33705;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assuming that we already have (as seen in the previous examples) a</font></font></nobr></div>
<div style="position:absolute;top:33735;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chain and a table, to accept the packages of a specific chain we can</font></font></nobr></div>
<div style="position:absolute;top:33765;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33811;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name [operators] accept</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33848;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And a specific example, for example accept the use of ftp (towards our host):</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33894;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input tcp dport 21 accept</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33932;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we would have it this way:</font></font></nobr></div>
<div style="position:absolute;top:33948;left:210"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch8.2.1_Pg29_1.png" /></nobr></div>
<div style="position:absolute;top:34047;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To reject packages we would do exactly the same but changing</font></font></nobr></div>
<div style="position:absolute;top:34077;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accet by drop:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34123;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name [operators] drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:34168;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.2 Jumping to chains</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34209;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar to iptables, we can also have custom strings,</font></font></nobr></div>
<div style="position:absolute;top:34239;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">once we have created some, we can redirect the packages that come by</font></font></nobr></div>
<div style="position:absolute;top:34269;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a base string (eg input) to this string to deal with there. </font><font style="vertical-align: inherit;">The format a</font></font></nobr></div>
<div style="position:absolute;top:34298;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">follow is as follows:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34344;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name [operators] jump custom_string</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34382;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34428;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input tcp dport 9999 jump personal_string_test</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34478;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34627;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 30</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34814;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We would have the following:</font></font></nobr></div>
<div style="position:absolute;top:34829;left:210"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch8.2.2_Pg30_1.png" /></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35054;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.3 Package log</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35095;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to do a full package log in nftables, we need a larger</font></font></nobr></div>
<div style="position:absolute;top:35125;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or equal to 3.17, if a minor kernel is used, the following command can be used</font></font></nobr></div>
<div style="position:absolute;top:35155;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to allow the log:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35201;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modprobe ipt_LOG</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35239;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To use the package log we do:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35285;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name [operators] log</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35322;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the same example that we use in iptables for the ssh connection loggin</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35368;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input tcp dport 22 ct state new log prefix \ "New</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35394;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh connection \ "accept</font></font></nobr></div>
<div style="position:absolute;top:35436;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35482;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ct state to indicate the state the connection should be in (new,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35507;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">established, related, etc)</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35553;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new the state itself</font></font></font></nobr></div>
<div style="position:absolute;top:35595;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log prefix We are indicating that the prefix that</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35621;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New ssh connection</font></font></nobr></div>
<div style="position:absolute;top:35666;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35815;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 31</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36002;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we look at the log in / var / log / syslog when making an ssh connection to our own</font></font></nobr></div>
<div style="position:absolute;top:36032;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system we will have the following result:</font></font></nobr></div>
<div style="position:absolute;top:36047;left:205"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch8.2.3_Pg31_1.png" /></nobr></div>
<div style="position:absolute;top:36091;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This capture is cropped.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36140;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2.4 NAT</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36181;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As with iptables, nftables can also do nat and in a more sim-</font></font></nobr></div>
<div style="position:absolute;top:36211;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ple for its syntax, again, we distinguish between SNAT (source nat) and DNAT</font></font></nobr></div>
<div style="position:absolute;top:36241;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(destination nat)</font></font></nobr></div>
<div style="position:absolute;top:36281;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. SNAT</font></font></nobr></div>
<div style="position:absolute;top:36320;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To SNAT and want to use our host as if it were a router,</font></font></nobr></div>
<div style="position:absolute;top:36350;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We must activate the ip_forward bit as we did in the iptables example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:36394;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 1&gt; / proc / sys / net / ipv4 / ip_forward</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36429;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once this is done we can start to establish SNAT with the following</font></font></nobr></div>
<div style="position:absolute;top:36459;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steps:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:36503;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add table nat</font></font></font></nobr></div>
<div style="position:absolute;top:36544;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain nat prerouting {type nat hook prerouting priority 0 \; </font><font style="vertical-align: inherit;">}</font></font></font></nobr></div>
<div style="position:absolute;top:36584;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add chain nat postrouting {type nat hook postrouting priority 0 \; </font><font style="vertical-align: inherit;">}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36620;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this we have created the nat table with the base chains prerouting and postrouting</font></font></nobr></div>
<div style="position:absolute;top:36650;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(we created the 2 for the example of snat and dnat, although it is not necessary if only</font></font></nobr></div>
<div style="position:absolute;top:36679;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implement one of the cases).</font></font></nobr></div>
<div style="position:absolute;top:36709;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Following the example we did in iptables, to do nat (snat or dnat)</font></font></nobr></div>
<div style="position:absolute;top:36739;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of a network we follow this format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:36783;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat [postrouing | </font><font style="vertical-align: inherit;">prerouting] ip [saddr | daddr] [red notation</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36809;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bar | ip] [oif | iif] [network interface] [snat | ndat] [ip]</font></font></nobr></div>
<div style="position:absolute;top:36854;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:37003;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 32</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37190;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the practical example of snatting</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:37236;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat postrouting ip saddr 192.168.1.0/24 oif wlan0 snat 8.8.8.8</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37273;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:37319;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saddr indicates the ip or network from which the packets come</font></font></font></nobr></div>
<div style="position:absolute;top:37361;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oif defines the interface through which packets are collected, in this case wlan0</font></font></font></nobr></div>
<div style="position:absolute;top:37403;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snat indicates the ip that the packets will have as a source when leaving the network</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37441;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way, if our host is a router that is connected to the indicated network</font></font></nobr></div>
<div style="position:absolute;top:37471;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the hosts that have our host configured as a gateway, the ip will change</font></font></nobr></div>
<div style="position:absolute;top:37501;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">origin to 8.8.8.8 of the packets that leave our network.</font></font></nobr></div>
<div style="position:absolute;top:37542;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. DNAT</font></font></nobr></div>
<div style="position:absolute;top:37584;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To do dnat, if we have a web server on our network and we want</font></font></nobr></div>
<div style="position:absolute;top:37614;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">be accessible from the outside if nat is being used, we must follow the same</font></font></nobr></div>
<div style="position:absolute;top:37644;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format than in the previous case, and the following would suffice:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:37690;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat prerouting iif wlan0 tcp dport 80 dnat 192.168.1.3</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37728;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:37774;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iif indicates the interface through which the packages will come, in this case wlan0</font></font></font></nobr></div>
<div style="position:absolute;top:37816;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp dport 80 the port and protocol where the packets will come.</font></font></font></nobr></div>
<div style="position:absolute;top:37858;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnat transfers the destination ip, it would change the IP of our host (the</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37883;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">router) by 192.168.1.3 (that of the web server)</font></font></nobr></div>
<div style="position:absolute;top:37925;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way, the web server can be accessed from outside our</font></font></nobr></div>
<div style="position:absolute;top:37955;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net. </font><font style="vertical-align: inherit;">It should be said that nftables allows us to also make a set of ports for</font></font></nobr></div>
<div style="position:absolute;top:37985;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the same destination, for example:</font></font></nobr></div>
<div style="position:absolute;top:38042;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38191;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 33</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38382;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat prerouting iif wlan0 tcp dport {80, 443} dnat 192.168.1.3</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38414;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way we are redirecting so many packets that come through the</font></font></nobr></div>
<div style="position:absolute;top:38444;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port 80 and 443.</font></font></nobr></div>
<div style="position:absolute;top:38481;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. NAT FLAGS</font></font></nobr></div>
<div style="position:absolute;top:38517;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an extra to iptables, nftables implements as of kernel 3.18 the mapping of</font></font></nobr></div>
<div style="position:absolute;top:38547;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random ports, as well as including keeping these numbers</font></font></nobr></div>
<div style="position:absolute;top:38577;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of ports for each connection. </font><font style="vertical-align: inherit;">The parameters are:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38618;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random: Random source ports.</font></font></font></nobr></div>
<div style="position:absolute;top:38657;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random-fully: Random ports (origin and destination).</font></font></font></nobr></div>
<div style="position:absolute;top:38696;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">persistent: Maintains the ports for the origin and destination for each connection-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38722;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ion.</font></font></nobr></div>
<div style="position:absolute;top:38758;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the example above, we would use it as follows:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38799;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat postrouting masquerade random, persistent</font></font></font></nobr></div>
<div style="position:absolute;top:38838;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat postrouting ip saddr 192.168.1.0/24 oif wlan0 snat 8.8.8.8</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38864;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">randomly-fully</font></font></nobr></div>
<div style="position:absolute;top:38902;left:260"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: The nat examples have been inspired by the manual</font></font></nobr></div>
<div style="position:absolute;top:38932;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of nftables available at: </font></font></nobr></div>
<div style="position:absolute;top:38947;left:238"><nobr><font style="font-size:15px"><a href="http://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_%2528NAT%2529"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_%2528NAT%2529</font></font></a></font></nobr></div>
</span></font>

<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:39012;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3 Marks on packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39056;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As in iptables, nftables allows you to dial packets with numbers using the</font></font></nobr></div>
<div style="position:absolute;top:39086;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set mark option, to repeat the example used in the iptables section in the</font></font></nobr></div>
<div style="position:absolute;top:39115;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which we mark the packets that are through port 80 to know what pages</font></font></nobr></div>
<div style="position:absolute;top:39145;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">websites were visited on our network, we must follow the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:39186;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output tcp dport 80 mark set 9999</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39230;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39379;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 34</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:39561;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4 Queueing of packages</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39605;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As in iptables, we can queue packets in nftables to queue-</font></font></nobr></div>
<div style="position:absolute;top:39635;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to user space, this feature is available from the kernel</font></font></nobr></div>
<div style="position:absolute;top:39665;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.14 and it is necessary to have the libnetfilter_queue library (available in some</font></font></nobr></div>
<div style="position:absolute;top:39695;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official repositories or in the git </font></font></nobr></div>
<div style="position:absolute;top:39710;left:201"><nobr><font style="font-size:15px"><a href="https://git.netfilter.org/libnetfilter%5Fqueue/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://git.netfilter.org/libnetfilter_queue</font></font></a></font></nobr></div>
</span></font>

<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39755;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To do this we follow the following format:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:39801;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add table_name string_name [operators] queue [num value o</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39826;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minimum_value-maximum_value]</font></font></nobr></div>
<div style="position:absolute;top:39868;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we do not add a number, the default value will be 0.</font></font></nobr></div>
<div style="position:absolute;top:39898;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Practical example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:39944;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add filter input counter queue num 45</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39982;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this we are already marking the packages that go to our host, if we generate</font></font></nobr></div>
<div style="position:absolute;top:40012;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we love some traffic, we can see it in action:</font></font></nobr></div>
<div style="position:absolute;top:40042;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We must bear in mind that if there is no program listening to</font></font></nobr></div>
<div style="position:absolute;top:40072;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queue, packages will be rejected. </font><font style="vertical-align: inherit;">COMPLETE / ASK util queue</font></font></nobr></div>
<div style="position:absolute;top:40102;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can also enable an option for which in the event that it does not</font></font></nobr></div>
<div style="position:absolute;top:40131;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is no application listening in the user space to avoid the</font></font></nobr></div>
<div style="position:absolute;top:40161;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packet sizing and being lost. </font><font style="vertical-align: inherit;">Therefore, the package will be accepted:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:40207;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add filter input counter queue num 45 bypass</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40418;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 4</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:40567;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 35</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:40746;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 Use of matchs</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40798;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In both iptables and nftables we can use mach to point</font></font></nobr></div>
<div style="position:absolute;top:40828;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocols, ports, ips, etc., but there are some that are interesting to</font></font></nobr></div>
<div style="position:absolute;top:40858;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jump since its use can be very useful as the traffic limit or the</font></font></nobr></div>
<div style="position:absolute;top:40888;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">package meta-information.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:40940;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1 Package meta-information</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40983;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The meta-information provided by the packages can be very useful, since</font></font></nobr></div>
<div style="position:absolute;top:41013;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">who can tell us who is the creator of the package. </font><font style="vertical-align: inherit;">In iptables, we have the</font></font></nobr></div>
<div style="position:absolute;top:41043;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">following options regarding the creator of the packages:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:41089;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid-owner can capture packets based on user id.</font></font></font></nobr></div>
<div style="position:absolute;top:41131;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gid-owner can capture packets based on group id.</font></font></font></nobr></div>
<div style="position:absolute;top:41173;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid-owner can capture packets based on the id of a process.</font></font></font></nobr></div>
<div style="position:absolute;top:41215;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sid-owner can capture packets based on the id of a session.</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41252;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And and an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:41299;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A OUTPUT -o wlan0 -m owner uid-owner caballeroalba -j AC-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41324;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEPT</font></font></nobr></div>
<div style="position:absolute;top:41366;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here we tell iptables to accept packets with the id the user ca-</font></font></nobr></div>
<div style="position:absolute;top:41396;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balleroalba.</font></font></nobr></div>
<div style="position:absolute;top:41426;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In nftables, these features are also implemented:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:41472;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output oif wlan0 meta skuid caballeroalba accept</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41510;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we can see, a simpler syntax is used.</font></font></nobr></div>
<div style="position:absolute;top:41606;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41755;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 36</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:41937;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2 Traffic limit</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41981;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Both in iptables and nftables you can make use of parameters for the</font></font></nobr></div>
<div style="position:absolute;top:42011;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traffic limit that allows us, for example, to alleviate a DDOS attack.</font></font></nobr></div>
<div style="position:absolute;top:42041;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables an example of an abusive ping:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:42087;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A FORWARD -p icmp icmp-type echo-request -m limit limit</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42113;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 / s -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:42149;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: this example is taken from </font></font></nobr></div>
<div style="position:absolute;top:42165;left:235"><nobr><font style="font-size:15px"><a href="http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html</font></font></a></font></nobr></div>
</span></font>

<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42220;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And in nftables:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:42266;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter forward icmp type echo-request limit rate 10 / second</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42292;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accept</font></font></nobr></div>
<div style="position:absolute;top:42794;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:42943;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 37</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:43122;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 advanced data structures in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43174;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nftables allows the use of advanced data structures for the improvement of</font></font></nobr></div>
<div style="position:absolute;top:43204;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance in packet sorting, this is a feature not available</font></font></nobr></div>
<div style="position:absolute;top:43234;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In iptables, this includes:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43278;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sets</font></font></font></nobr></div>
<div style="position:absolute;top:43318;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dictionaries</font></font></font></nobr></div>
<div style="position:absolute;top:43359;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intervals</font></font></font></nobr></div>
<div style="position:absolute;top:43399;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maps</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:43446;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1 Sets</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43490;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A generic set infrastructure is included in nftables that allows</font></font></nobr></div>
<div style="position:absolute;top:43520;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use all supported selectors to build sets. </font><font style="vertical-align: inherit;">With this infrastructure</font></font></nobr></div>
<div style="position:absolute;top:43549;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dictionaries and maps can be represented.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43598;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1 Anonymous sets</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43639;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anonymous sets are those that are:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43683;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Those bound to a rule, if a rule is removed, the set is also removed.</font></font></font></nobr></div>
<div style="position:absolute;top:43723;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Those that do not have a proper name, the kernel assigns an automatic one-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43749;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mind</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43794;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not upgradeable, you cannot add or remove items when they are attached</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43819;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two to one rule.</font></font></nobr></div>
<div style="position:absolute;top:43858;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following rule represents an anonymous set:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:43902;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output tcp dport {80, 443} counter</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43937;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where {80,443} represents the anonymous set.</font></font></nobr></div>
<div style="position:absolute;top:43982;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44131;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 38</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44316;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2 Named sets</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44357;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sets can be created with an associated name and added to an already created table</font></font></nobr></div>
<div style="position:absolute;top:44387;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:44433;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add set table_name set_name {type [ipv4_addr | </font><font style="vertical-align: inherit;">ipv6_addr |</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44459;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ether_addr | </font><font style="vertical-align: inherit;">inet_proto | </font><font style="vertical-align: inherit;">inet_service | </font><font style="vertical-align: inherit;">mark]}</font></font></nobr></div>
<div style="position:absolute;top:44501;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And an example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:44547;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add set filter ip_list {type ipv4_addr \; </font><font style="vertical-align: inherit;">}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44584;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way we have added a set of ipv4 addresses to the filter table:</font></font></nobr></div>
<div style="position:absolute;top:44599;left:205"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch10.1.2_Pg38_1.png" /></nobr></div>
<div style="position:absolute;top:44714;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we can add elements in a unique way:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:44760;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add element filter ip_list {192.168.1.5}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44798;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or using an anonymous set:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:44844;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add element filter ip_list {192.168.1.6, 192.168.1.7}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44882;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we check:</font></font></nobr></div>
<div style="position:absolute;top:44895;left:205"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch10.1.2_Pg38_2.png" /></nobr></div>
<div style="position:absolute;top:45043;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we can bind this set into a ruler, for example add a counter</font></font></nobr></div>
<div style="position:absolute;top:45073;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the packages that are destined for the ips of the set:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45119;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip daddr @ip_list counter</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45170;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45319;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 39</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45506;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Looking at the table, we see the set linked in the input string:</font></font></nobr></div>
<div style="position:absolute;top:45521;left:205"><nobr><img src="iptables-vs-nftables_nftables-gui_github_files/Ch10.1.2_Pg39_1.png" /></nobr></div>
<div style="position:absolute;top:45628;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to named sets, elements can be added or removed, which is not</font></font></nobr></div>
<div style="position:absolute;top:45658;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we can do in anonymous sets.</font></font></nobr></div>
<div style="position:absolute;top:45688;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To check the real difference with iptables, we can see this done fact</font></font></nobr></div>
<div style="position:absolute;top:45717;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by Eric leblond in this article </font></font><a href="https://home.regit.org/2014/01/why-you-will-love-nftables/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">why you love nftables</font></font></a></nobr></div>
<div style="position:absolute;top:45747;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have the following actions in nftables:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45793;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip6tables -A INPUT -p tcp -m multiport dports 22,80,443 -j ACCEPT</font></font></font></nobr></div>
<div style="position:absolute;top:45835;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip6tables -A INPUT -p icmpv6 icmpv6-type neighbor-solicitation -j AC-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45861;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEPT</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45907;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip6tables -A INPUT -p icmpv6 icmpv6-type echo-request -j ACCEPT</font></font></font></nobr></div>
<div style="position:absolute;top:45949;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip6tables -A INPUT -p icmpv6 icmpv6-type router-advertisement -j AC-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45975;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEPT</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:46021;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip6tables -A INPUT -p icmpv6 icmpv6-type neighbor-advertisement -j</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46046;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:46088;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And they can be expressed in nftables in just 2 operations:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:46134;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip6 filter input tcp dport {telnet, http, https} accept</font></font></font></nobr></div>
<div style="position:absolute;top:46176;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip6 filter input icmpv6 type {nd-neighbor-request, echo-request,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46202;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nd-router-advert, nd-neighbor-advert} accept</font></font></nobr></div>
<div style="position:absolute;top:46244;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Can you see the difference?</font></font></nobr></div>
<div style="position:absolute;top:46358;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46507;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 40</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:46692;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.3 Listing sets</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46733;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the following format, sets can be listed:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:46779;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft list set table_name set_name</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:18px;font-family:Times">
<div style="position:absolute;top:46827;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2 Dictionaries</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46870;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dictionaries or verdict maps is a remarkable functionality in nftables.</font></font></nobr></div>
<div style="position:absolute;top:46900;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They allow you to relate an action to an element. </font><font style="vertical-align: inherit;">Internally they use a general set</font></font></nobr></div>
<div style="position:absolute;top:46930;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ico.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:46980;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.1 Anonymous dictionaries</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47021;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assuming we have several custom chains we can see how we can-</font></font></nobr></div>
<div style="position:absolute;top:47050;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can create in one line several actions, the format to make a dic-</font></font></nobr></div>
<div style="position:absolute;top:47080;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anonymous assignee is:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47126;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule table_name string_name ip protocol vmap {[proto-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47152;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colo1 jump string1], [proto2 jump string2] ...}</font></font></nobr></div>
<div style="position:absolute;top:47194;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way we are creating in a line n jumps that will be in the chains</font></font></nobr></div>
<div style="position:absolute;top:47224;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">customized according to your protocol</font></font></nobr></div>
<div style="position:absolute;top:47254;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example taken from the </font><a href="http://wiki.nftables.org/wiki-nftables/index.php/Dictionaries"><font style="vertical-align: inherit;">nftables</font></a><font style="vertical-align: inherit;"> wiki </font></font><a href="http://wiki.nftables.org/wiki-nftables/index.php/Dictionaries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></a></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47300;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip filter input ip protocol vmap {tcp: jump tcp-chain, udp</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47326;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: jump udp-chain, icmp: jump icmp-chain}</font></font></nobr></div>
<div style="position:absolute;top:47367;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example the map is created and the tcp, udp and icmp protocols are associated to</font></font></nobr></div>
<div style="position:absolute;top:47397;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different chains.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:47447;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.2 Named dictionaries</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47488;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can create named dictionaries following the following format:</font></font></nobr></div>
<div style="position:absolute;top:47546;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:47695;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 41</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47886;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add map table_name dictionary_name {type [type]: verdict \;</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47912;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:47950;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47994;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add map filter dictionary {type ipv4_addr: verdict \; </font><font style="vertical-align: inherit;">}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48028;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we can add elements of the type of which is the dictionary:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48071;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add element filter dictionary {192.168.1.3: accept, 192.168.1.5 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48097;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:48136;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once this is done, we can use the dictionary the actions associated with its</font></font></nobr></div>
<div style="position:absolute;top:48166;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elements:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48209;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter ouput daddr vmap @dictionary</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48243;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actually this rule would be causing the following:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48286;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output daddr 192.168.1.3 accept</font></font></font></nobr></div>
<div style="position:absolute;top:48327;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output daddr 192.168.1.5 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:48371;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.3 Intervals</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48412;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nftables allows the use of expressions with intervals, the ranges are read as</font></font></nobr></div>
<div style="position:absolute;top:48442;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minimum_value-maximum_value, the intervals serve both ips and</font></font></nobr></div>
<div style="position:absolute;top:48472;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ports, some example:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48515;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output ip daddr 8.8.8.4-8.8.8.8 drop</font></font></font></nobr></div>
<div style="position:absolute;top:48555;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output tcp ports 50-60 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48590;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can also use the sets to set the intervals from the</font></font></nobr></div>
<div style="position:absolute;top:48620;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">own set:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:48663;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip filter input ip saddr {192.168.1.1-192.168.1.200, 192.168.2.1-</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48689;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.2.200} drop</font></font></nobr></div>
<div style="position:absolute;top:48734;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:48883;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="42"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 42</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49070;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And in the same way the dictionaries:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:49116;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip filter forward ip daddr vmap {192.168.1.1-192.168.1.200:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49141;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jump chain-dmz, 192.168.2.1-192.168.20.250: jump chain-desktop}</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:49191;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.4 Maps</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49232;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maps associate a key with a value, and can be defined on the same line</font></font></nobr></div>
<div style="position:absolute;top:49262;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of the rule to create, an example of its use:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:49308;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip nat prerouting dnat tcp dport map {80: 192.168.1.100,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49333;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8888: 192.168.1.101}</font></font></nobr></div>
<div style="position:absolute;top:49375;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can see that depending on the port we dnat to one ip or another doing</font></font></nobr></div>
<div style="position:absolute;top:49405;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use of a map, this saves us from having to create two rules one for ip depending</font></font></nobr></div>
<div style="position:absolute;top:49435;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of the port.</font></font></nobr></div>
<div style="position:absolute;top:49465;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: the examples of maps and intervals have been taken from the wiki of</font></font></nobr></div>
<div style="position:absolute;top:49495;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nftables </font></font><font style="font-size:15px"><a href="http://wiki.nftables.org/wiki-nftables/index.php/Intervals"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://wiki.nftables.org/wiki-nftables/index.php/Intervals</font></font></a></font></nobr></div>
<div style="position:absolute;top:49922;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:50071;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="43"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 43</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:50250;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11 Expressions in nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50302;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nftables provides a set of expressions to make operators and</font></font></nobr></div>
<div style="position:absolute;top:50332;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to be able to have more precise rules. </font><font style="vertical-align: inherit;">These are:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:50378;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not equal, can be used! =</font></font></font></nobr></div>
<div style="position:absolute;top:50420;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lt less than, you can use &lt;</font></font></font></nobr></div>
<div style="position:absolute;top:50462;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gt greater than, you can use&gt;</font></font></font></nobr></div>
<div style="position:absolute;top:50504;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">less than or equal to it, you can use &lt;=</font></font></font></nobr></div>
<div style="position:absolute;top:50546;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ge greater than or equal, you can use&gt; =</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50583;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the symbols &lt;or&gt; are used, it is necessary to use the \ &lt;or \&gt; since the terminal</font></font></nobr></div>
<div style="position:absolute;top:50613;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would understand it as the standard input or output.</font></font></nobr></div>
<div style="position:absolute;top:50643;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A simple example of being able to use these operators:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:50689;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter output tcp dport! = 80 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51110;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:51259;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="44"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 44</font></font></b></a></font></td></tr></tbody></table></div><font size="4" face="Times"><span style="font-size:22px;font-family:Times">
<div style="position:absolute;top:51438;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 Example of practical use with nftables</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51490;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To finish we can expose a practical use of a practical of nftables in</font></font></nobr></div>
<div style="position:absolute;top:51520;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a network, the problem is:</font></font></nobr></div>
<div style="position:absolute;top:51562;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. We have a company, in which we have 3 subnets: 192.168.1.0/24,</font></font></nobr></div>
<div style="position:absolute;top:51592;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.2.0/24 and 192.168.3.0/24</font></font></nobr></div>
<div style="position:absolute;top:51634;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. For the 192.168.1.0/24 network we have the following requirements:</font></font></nobr></div>
<div style="position:absolute;top:51679;left:244"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a) It is made up of 2 servers, one web (192.168.1.2) and another ftp</font></font></nobr></div>
<div style="position:absolute;top:51709;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(192.168.12), in which nat must be implemented</font></font></nobr></div>
<div style="position:absolute;top:51745;left:243"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(b) Servers should ONLY listen / respond to requests, never</font></font></nobr></div>
<div style="position:absolute;top:51774;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make them out</font></font></nobr></div>
<div style="position:absolute;top:51819;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. For 192.168.2.0/24 network we have the following requirements:</font></font></nobr></div>
<div style="position:absolute;top:51864;left:244"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a) It is made up of company workers, therefore they can</font></font></nobr></div>
<div style="position:absolute;top:51894;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">give in to the outside</font></font></nobr></div>
<div style="position:absolute;top:51930;left:243"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(b) The use of certain web pages (facebook and twitter) is not allowed</font></font></nobr></div>
<div style="position:absolute;top:51966;left:245"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) They cannot receive requests from abroad.</font></font></nobr></div>
<div style="position:absolute;top:52011;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. For the 192.168.3.0/24 network we have the following requirements:</font></font></nobr></div>
<div style="position:absolute;top:52055;left:244"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a) It is formed by teams in tests, therefore they can only have</font></font></nobr></div>
<div style="position:absolute;top:52085;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">access between them and they can never receive requests from abroad</font></font></nobr></div>
<div style="position:absolute;top:52115;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nor access it.</font></font></nobr></div>
<div style="position:absolute;top:52160;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assuming that we have a computer that makes a router, and this is connected to the</font></font></nobr></div>
<div style="position:absolute;top:52190;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 networks and the internet, we can configure nftables as follows to</font></font></nobr></div>
<div style="position:absolute;top:52220;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solve the following requirements:</font></font></nobr></div>
<div style="position:absolute;top:52250;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the 192.168.1.0/24 network:</font></font></nobr></div>
<div style="position:absolute;top:52298;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:52447;left:0"><hr><table width="100%" border="0"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="45"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 45</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52638;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat prerouting ip daddr 192.168.1.2 tcp dport 80 dnat 192.168.1.2</font></font></font></nobr></div>
<div style="position:absolute;top:52680;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule nat prerouting ip daddr 192.168.1.3 tcp dport 21 dnat 192.168.1.3</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52717;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The previous two can be summarized using a map in:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52763;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule ip nat prerouting dnat tcp dport map {80: 192.168.1.2, 21</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52789;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 192.168.1.3} (assuming these ips from the servers)</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52835;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip saddr 192.168.1.0/24 ct state new drop</font></font></font></nobr></div>
<div style="position:absolute;top:52877;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip saddr 192.168.1.0/24 ct state established accept</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52915;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the 192.168.2.0/24 network:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:52961;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip saddr 192.168.2.0/24 ct state new, established</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52986;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accept</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:53033;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip daddr 192.168.2.0/24 ct state new drop</font></font></font></nobr></div>
<div style="position:absolute;top:53074;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip saddr 192.168.2.0/24 ip daddr {8.8.8.8, 8.8.8.4}</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53100;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drop (assuming facebook.es -&gt; 8.8.8.8 and twitter.es -&gt; 8.8.8.4)</font></font></nobr></div>
<div style="position:absolute;top:53142;left:201"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For 192.168.3.0/24 network</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:53188;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip saddr 192.168.3.0/24 drop</font></font></font></nobr></div>
<div style="position:absolute;top:53230;left:223"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">• </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nft add rule filter input ip daddr 192.168.3.0/24 drop</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53486;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Four. Five</font></font></nobr></div>
</span></font>
</body>
</html>
